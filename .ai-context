# AI ASSISTANT CONTEXT - POOLTOOL PROJECT

This file provides essential context for AI assistants working on the PooltTool project.

**üîß FRAMEWORK**: This project is built on **[Bash with Nails](https://github.com/mindaugasbarysas/bashwithnails)**, a bash framework providing module loading, namespacing, and dependency management.

## MANDATORY READING BEFORE ANY CODE CHANGES

üö® **STOP**: You MUST read these files before making any modifications:

### 1. DEVELOPER_GUIDE.md
- Contains critical namespace patterns and coding conventions
- Explains the bootstrap system's automatic function transformation
- Shows performance best practices for bulk operations
- **Violating these patterns WILL break the module system**

### 2. INTERACTIVE_DRIVE_MANAGEMENT_PLAN.md  
- Project architecture and current implementation status
- Performance metrics and optimization details
- Phase-by-phase development progress
- **Essential for understanding the system design**

### 3. bootstrap.sh + [Bash with Nails Documentation](https://github.com/mindaugasbarysas/bashwithnails/blob/master/docs/man.md)
- Core module loading mechanism (Bash with Nails framework)
- Automatic namespace transformation rules
- **Critical to understand before writing any functions**

## COMMON MISTAKES TO AVOID

‚ùå **DON'T**: Call bootstrap_load_module directly for testing
```bash
bootstrap_load_module snapraid/devices && snapraid::devices names  # WRONG!
```

‚úÖ **DO**: Use pooltool.sh commands for module testing
```bash
./pooltool.sh command-that-uses-module  # CORRECT - proper module loading
```

‚ùå **DON'T**: Parse visual layouts for data
```bash
# WRONG - visual layout is OUTPUT, not source data
pooltool drivemap | grep "Position 1"
```

‚úÖ **DO**: Use driveutils unified mapping for real drive data
```bash
# CORRECT - access the actual data source
./pooltool.sh test-drives  # Shows unified mapping data
# Then use pooltool::create_unified_mapping in your code
```

‚ùå **DON'T**: Use generic function names that cause namespace collisions
```bash
# WRONG! Multiple modules with same function name
function print_help {  # This will overwrite other modules' print_help!
function helper {      # Gets overwritten by last loaded module!
```

‚úÖ **DO**: Prefix helper functions with module name
```bash
# CORRECT! Module-specific naming prevents collisions
function workflow::print_help {  # Safe from overwrites
function monitor::helper {       # Each module has own namespace
```

‚ùå **DON'T**: Make individual health calls for multiple drives
```bash
for drive in drives; do
    pooltool::get_drive_health "$drive"  # SLOW - 50+ seconds!
done
```

‚úÖ **DO**: Use bulk collection functions
```bash
pooltool::get_all_health_info_efficient "$controller" "${unified_array[@]}"  # FAST - 3 seconds!
```

## PROJECT PRINCIPLES

1. **Framework Compliance**: Follow [Bash with Nails](https://github.com/mindaugasbarysas/bashwithnails) patterns exactly
2. **Performance First**: Always use bulk operations for multi-drive tasks
3. **Namespace Safety**: Prefix helper functions with module name to avoid collisions
4. **Backward Compatibility**: Don't break existing command interfaces
5. **Documentation**: Update relevant .md files when adding features
6. **Testing**: Use built-in test commands to verify changes

## CURRENT ARCHITECTURE

- **Framework**: Built on [Bash with Nails](https://github.com/mindaugasbarysas/bashwithnails) for module system and namespacing
- **Module System**: Bootstrap-based with automatic namespace transformation
- **Data Layer**: Unified device mapping with efficient caching
- **Performance**: 20x optimization through bulk SMART data collection
- **UI**: Interactive grid-based drive visualization
- **Automation**: CLI modes with JSON output and proper exit codes
- **Health Monitoring**: Comprehensive drive health assessment with upgrade evaluation

## KEY COMMANDS

### Health and Evaluation
```bash
./pooltool.sh health                  # Check all drive health
./pooltool.sh health --evaluate       # Analyze drives for upgrade recommendations  
./pooltool.sh health --evaluate --json # Machine-readable evaluation output
```

The `--evaluate` feature provides comprehensive drive analysis including:
- Age assessment (power-on hours)
- Capacity analysis (drive size vs. utilization)
- Health status (SMART data)
- Temperature monitoring
- Risk scoring and upgrade prioritization

### Workflow Management
```bash
./pooltool.sh workflow list           # Show available workflows
./pooltool.sh workflow status         # Check workflow progress
```

## GETTING STARTED

1. Read the three mandatory files above
2. Run `./pooltool.sh` to see the interactive system
3. Examine existing commands in `modules/pooltool/commands/`
4. Use test commands like `test-health-simple` for debugging
5. Follow the patterns in DEVELOPER_GUIDE.md exactly

Remember: This is a production system managing critical storage infrastructure. 
Follow the established patterns to maintain reliability and performance.
